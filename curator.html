<!DOCTYPE html>
<html lang="en">
<head>
    <title>Curator Dashboard - Archivault</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #1e293b; padding: 15px; border-radius: 15px; border-bottom: 3px solid #22d3ee; }
        .settings-bar { background: #334155; padding: 15px; border-radius: 12px; margin: 15px 0; display: flex; align-items: center; gap: 20px; }
        .chart-area { background: #1e293b; border-radius: 15px; padding: 20px; height: 50vh; }
        input[type=range] { width: 200px; }
        .safety-val { font-size: 1.2em; color: #facc15; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0">Curator Monitor</h2>
        <select id="tripPicker" style="padding:8px; border-radius:5px;"><option>-- Choose Trip --</option></select>
    </div>

    <div class="settings-bar">
        <strong>Remote Safety Limit:</strong>
        <input type="range" id="safetySlider" min="0.5" max="5.0" step="0.1" value="1.5">
        <span class="safety-val"><span id="limitDisp">1.50</span> G</span>
        <small>(This updates the driver's alarm in real-time)</small>
    </div>

    <div class="chart-area">
        <canvas id="tripChart"></canvas>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCLiWeNn7SVAs0VDpv8ST6xvplqGytnnIU",
            authDomain: "archivault-8d6ff.firebaseapp.com",
            databaseURL: "https://archivault-8d6ff-default-rtdb.firebaseio.com/",
            projectId: "archivault-8d6ff"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. UPDATE SAFETY LIMIT
        const slider = document.getElementById('safetySlider');
        const disp = document.getElementById('limitDisp');
        
        slider.oninput = function() {
            let val = parseFloat(this.value).toFixed(2);
            disp.innerText = val;
            db.ref('safety_settings/max_g').set(val); // Write to Firebase
        };

        // 2. CHART & DATA LOGIC (Same as before)
        const ctx = document.getElementById('tripChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Shock (G)', data: [], borderColor: '#22d3ee', fill: true, stepped: true }] },
            options: { responsive: true, maintainAspectRatio: false }
        });

        db.ref('trips').on('value', (snap) => {
            const picker = document.getElementById('tripPicker');
            picker.innerHTML = '<option value="">-- Choose Trip --</option>';
            snap.forEach(child => {
                let opt = document.createElement('option');
                opt.value = child.key; opt.innerText = child.key;
                picker.appendChild(opt);
            });
        });

        document.getElementById('tripPicker').onchange = function() {
            chart.data.labels = []; chart.data.datasets[0].data = [];
            db.ref('trips/' + this.value).on('child_added', (snap) => {
                const val = snap.val();
                chart.data.labels.push(new Date(val.t).toLocaleTimeString());
                chart.data.datasets[0].data.push(val.g);
                chart.update('none');
            });
        };
    </script>
</body>
</html>
